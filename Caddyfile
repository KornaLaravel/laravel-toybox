www.toybox-laravel.test {
    redir / https://toybox-laravel.test 301
}

toybox-laravel.test {
    root * APP_PATH/public
    encode zstd gzip
    file_server
    php_fastcgi unix//run/php/php8.2-fpm.sock

    # This rewrite is to prevent access to dot files and folders such
	# as .htaccess, .git, etc.
	rewrite {
		# This regex catches everything that contains "/." in the URL
		r \/\.
		if {path} not_starts_with .well-known
		to /index.php{uri}
	}

	# Rewrite non-existent URLs to our index.php controller
	rewrite {
		if {file} not favicon.ico
		to {path} {path}/ /index.php?{query}
	}

	header / {
		Strict-Transport-Security	"max-age=30758400"
		X-Content-Type-Options		"nosniff"
		X-Frame-Options			"deny"
		X-XSS-Protection		"1; mode=block"
		Referrer-Policy			"same-origin"
	}

    log {
		output file APP_PATH/storage/logs/caddy-access.log
	}

	handle_errors {
		@404 {
			expression {http.error.status_code} == 404
		}
		rewrite @404 /404.html
		file_server {
			root /var/dep/html
		}
	}
}
